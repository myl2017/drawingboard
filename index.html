<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>手机画板</title>
    <style>
        @font-face {
            font-family: 'iconfont';
            src: url('//at.alicdn.com/t/font_421346_3nlb90ab7vf5hfr.eot');
            src: url('//at.alicdn.com/t/font_421346_3nlb90ab7vf5hfr.eot?#iefix') format('embedded-opentype'),
            url('//at.alicdn.com/t/font_421346_3nlb90ab7vf5hfr.woff') format('woff'),
            url('//at.alicdn.com/t/font_421346_3nlb90ab7vf5hfr.ttf') format('truetype'),
            url('//at.alicdn.com/t/font_421346_3nlb90ab7vf5hfr.svg#iconfont') format('svg');
        }
        .iconfont {
            font-family:"iconfont" !important;
            font-size:30px;
            font-style:normal;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        *{ margin: 0; padding: 0;}
        body{ overflow: hidden;}
        .actions{ position: fixed; top: 0; left: 0; width: 100%; text-align: center;  padding: 10px; }
        .actions > .icon-wrapper{  display: flex; justify-content: space-around; }
        .actions .icon-wrapper #pen{  color: green; }
        .actions .icon-wrapper #eraser{ color: #FF69B4; }
        .actions .icon-wrapper .pen.active{ font-size: 35px; font-weight: bold;}
        .actions .icon-wrapper .eraser.active{ font-size: 35px; font-weight: bold;}
        .actions .icon-wrapper #clear{ color: #F5A617; }
        .actions .icon-wrapper #save{ color: #53BCE8; }
        .actions > i.iconfont{ display: block; }
        #canvas{ display: block; background-color: #ddd;}
    </style>
</head>
<body>
    <div class="actions">
        <div class="icon-wrapper">
            <i class="iconfont pen" id="pen">&#xe640;</i>
            <i class="iconfont eraser" id="eraser"> &#xe600;</i>
            <i class="iconfont" id="clear">&#xe602;</i>
            <i class="iconfont" id="save">&#xe612;</i>
        </div>
    </div>
    <canvas id="canvas" width="1536" height="735"></canvas>
</body>
<script>
    let clientWidth = document.documentElement.clientWidth         //元素的内部宽度
    let clientHeight = document.documentElement.clientHeight
    let pen = document.getElementById('pen')
    let eraser = document.getElementById('eraser')
    pen.addEventListener('click',function () {
        pen.classList.add("active");
        eraser.classList.remove('active')
    })
    eraser.addEventListener('click',function (e) {
        eraser.classList.add('active')
        pen.classList.remove('active')
    })

    let canvas = document.querySelector('#canvas')
    let context = canvas.getContext('2d');
    canvas.width = clientWidth
    canvas.height = clientHeight
    let  previousPoint = null
    canvas.addEventListener('touchmove',function (e) {
        e.preventDefault() //阻止页面滑动...
        let {pageX,pageY} = e.touches[0]
        if(document.querySelector('.active')!== undefined){
            let status = document.querySelector('.active').className
            if(status === 'iconfont pen active'){
                if(previousPoint){ //(!null===true)
                    context.strokeStyle = 'green'
                    context.beginPath();
                    context.moveTo(previousPoint.pageX,previousPoint.pageY);    //移动到的上一个点
                    context.lineTo(pageX, pageY);                               //移动到的下一个点
                    context.stroke();
                }
                previousPoint = {
                    "pageX":pageX,
                    "pageY":pageY
                } //previousPoint = {pageX,pageY}
            }else if(status === 'iconfont eraser active'){
                context.clearRect(pageX-5,pageY-5,20,20)
            }
        }else{
            return
        }
    })
    canvas.addEventListener('touchend',function (e) {
        previousPoint = null
    })
    let clear = document.getElementById('clear')
    clear.onclick = function () {
        context.clearRect(0,0,clientWidth,clientHeight)
    }
    let save = document.getElementById('save')
    save.onclick = function () {
        var data=canvas.toDataURL("image/png");
        var newWindow=window.open('about:blank','image from canvas');
        newWindow.document.write("<img src='"+data+"' alt='from canvas'/>");
    }
</script>
</html>
